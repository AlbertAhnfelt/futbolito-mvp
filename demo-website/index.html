<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Highlights Analyzer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Football Highlights Analyzer</h1>

        <div class="input-section">
            <select id="videoSelect">
                <option value="">Loading videos...</option>
            </select>
            <button id="convertBtn" onclick="convertToEvents()">Analyze Video</button>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <p>Analyzing video...</p>
        </div>

        <div id="resultsSection" style="display: none;">
            <h2>Events</h2>
            <table id="resultsTable">
                <thead>
                    <tr>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody id="resultsBody">
                </tbody>
            </table>
        </div>

        <div id="error" class="error" style="display: none;"></div>
    </div>

    <script>
        // Load available videos on page load
        async function loadVideos() {
            const videoSelect = document.getElementById('videoSelect');
            const error = document.getElementById('error');

            try {
                const response = await fetch('http://localhost:5000/videos/list');

                if (!response.ok) {
                    throw new Error('Failed to load videos');
                }

                const videos = await response.json();

                videoSelect.innerHTML = '<option value="">Select a video...</option>';

                if (videos.length === 0) {
                    videoSelect.innerHTML = '<option value="">No videos found in videos/ folder</option>';
                } else {
                    videos.forEach(video => {
                        const option = document.createElement('option');
                        option.value = video;
                        option.textContent = video;
                        videoSelect.appendChild(option);
                    });
                }

            } catch (err) {
                error.textContent = 'Error loading videos: ' + err.message;
                error.style.display = 'block';
                videoSelect.innerHTML = '<option value="">Error loading videos</option>';
            }
        }

        async function convertToEvents() {
            const filename = document.getElementById('videoSelect').value;
            const loading = document.getElementById('loading');
            const resultsSection = document.getElementById('resultsSection');
            const error = document.getElementById('error');
            const convertBtn = document.getElementById('convertBtn');

            if (!filename) {
                error.textContent = 'Please select a video';
                error.style.display = 'block';
                return;
            }

            error.style.display = 'none';
            resultsSection.style.display = 'none';
            loading.style.display = 'block';
            convertBtn.disabled = true;

            try {
                const response = await fetch('http://localhost:5000/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ filename: filename })
                });

                if (!response.ok) {
                    throw new Error('Analysis failed');
                }

                const data = await response.json();
                displayResults(data);

            } catch (err) {
                error.textContent = 'Error: ' + err.message;
                error.style.display = 'block';
            } finally {
                loading.style.display = 'none';
                convertBtn.disabled = false;
            }
        }

        function displayResults(highlights) {
            const resultsBody = document.getElementById('resultsBody');
            const resultsSection = document.getElementById('resultsSection');

            resultsBody.innerHTML = '';

            highlights.forEach(highlight => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${highlight.start_time}</td>
                    <td>${highlight.end_time}</td>
                    <td>${highlight.description}</td>
                `;
                resultsBody.appendChild(row);
            });

            resultsSection.style.display = 'block';
        }

        // Load videos when page loads
        window.addEventListener('DOMContentLoaded', loadVideos);
    </script>
</body>
</html>
